{"pageProps":{"post":{"title":"如何讓 Firefox 接受 .dev 站台的自簽憑證？","slug":"_deprecated/how-firefox-accept-local-credentials","content":"<p>有些站台在開發會使用 HTTPS 連線，一般情況可以略過頁面警告，或是透過自簽憑證讓瀏覽器信任這個連線。</p>\n<p>近期使用火狐瀏覽器開發專案時，竟然遇到一個情境完全無法略過警告，只能看著頁面乾瞪眼。</p>\n<p>這個專案是鎖 host 開發，例如將 <code>my-app.dev</code> 指向本機，這種模式在敝公司很常見。</p>\n<p>初始想法是設定自簽憑證也許就能排除，因此參考了下面兩篇保哥的文章：</p>\n<ol>\n<li><a href=\"https://blog.miniasp.com/post/2019/02/25/Creating-Self-signed-Certificate-using-OpenSSL\">如何使用 OpenSSL 建立開發測試用途的自簽憑證</a></li>\n<li><a href=\"https://blog.miniasp.com/post/2018/04/24/Using-PowerShell-to-build-Self-Signed-Certificate\">如何使用 PowerShell 建立開發測試用途的自簽憑證</a></li>\n</ol>\n<p>但是發現生成的 <code>.dev</code> 憑證只能匯入作業系統，無法匯入火狐，另外也無法直接設定 <code>.dev</code> 站台作為排除清單。</p>\n<h2>重新檢視問題</h2>\n<p>這篇<a href=\"https://ma.ttias.be/chrome-force-dev-domains-https-via-preloaded-hsts/\">文章</a>提到 <code>.dev</code> 網域強制用戶使用 HTTPS 連線，稱為 <a href=\"https://zh.wikipedia.org/wiki/HTTP%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8\">HSTS</a>，你無法手動排除受到 HSTS 影響的站台。</p>\n<p>因此猜測主因是站台使用了 <code>.dev</code> 結尾開發，總結遇到的問題：</p>\n<ol>\n<li>將 <code>.dev</code> 憑證匯入作業系統 => ok，但火狐不看作業系統的憑證</li>\n<li>無法將 <code>.dev</code> 結尾的憑證直接匯入火狐的 SSL 憑證管理員</li>\n<li>採用 HTTP 開發 => <code>.dev</code> 網域需要 HTTPS 連線</li>\n<li>受到 HSTS 影響的站台無法排除與跳過警示</li>\n</ol>\n<p>這個死胡同困擾了我一段時間，也不知道該用什麼關鍵字查詢，就只是找火狐是否有類似 <code>thisisunsafe</code> 的指令可以略過警示。</p>\n<h2>解法</h2>\n<p>意外的簡單：讓火狐信任作業系統的憑證，根據<a href=\"https://superuser.com/questions/1303396/how-to-fix-firefox-59-no-longer-accepting-my-self-signed-ssl-certificate-on-dev\">討論</a>與<a href=\"https://support.mozilla.org/en-US/kb/setting-certificate-authorities-firefox\">官方文件</a>，這應該是自簽憑證的建議做法：</p>\n<ol>\n<li>在網址列鍵入 <code>about:config</code></li>\n<li>搜尋 <code>security.enterprise_roots.enabled</code> 並設定為 <code>true</code></li>\n</ol>\n<p>至此就可以使用 HTTPS 開發 <code>.dev</code> 結尾的站台囉！</p>\n<p>火狐的 Issue 列表在 N 年前也有<a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1314010\">討論</a>此設定是否能夠預設開啟（預設信任作業系統提供的 SSL 憑證），細節有時間再爬文。</p>\n<p>萌新發文如有謬誤請大大指教。</p>\n"}},"__N_SSG":true}